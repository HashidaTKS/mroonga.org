<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.3. Storage mode &mdash; Mroonga v6.02 documentation</title>
    
    <link rel="stylesheet" href="../static/mroonga.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.02',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="top" title="Mroonga v6.02 documentation" href="../index.html" />
    <link rel="up" title="4. Tutorial" href="../tutorial.html" />
    <link rel="next" title="4.4. Wrapper mode" href="wrapper.html" />
    <link rel="prev" title="4.2. Mode" href="mode.html" /> 
      <meta property="fb:page_id" content="238184682903165" /><!-- mroonga -->
    <meta property="fb:admins" content="664204556" /><!-- kouhei.sutou -->
    <meta property="og:type" content="product" />
    <meta property="og:image" content="http://mroonga.org/images/logos/mroonga-icon-full-size.png" />
    <meta property="og:site_name" content="mroonga" />

    <link rel="stylesheet" href="/css/sphinx.css" type="text/css" />
  </head>

  <body role="document">
<div class="header">
  <h1 class="title">
    <a id="top-link" href="../../">
      <span class="project">mroonga</span>
      <span class="separator">-</span>
      <span class="description">An open-source storage engine for fast fulltext search with MySQL.</span>
    </a>
  </h1>

      <div class="facebook-buttons">
      <fb:like href="http://www.facebook.com/pages/mroonga/238184682903165"
               layout="standard"
               width="290"></fb:like>
    </div>
    <div class="other-language-links">

    <ul>
      <li><a href="../../ja/docs/tutorial/storage.html" title="日本語">日本語</a></li>
    </ul>
  </div>
</div>
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="wrapper.html" title="4.4. Wrapper mode"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mode.html" title="4.2. Mode"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mroonga v6.02 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" accesskey="U">4. Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="storage-mode">
<h1>4.3. Storage mode<a class="headerlink" href="#storage-mode" title="Permalink to this headline">¶</a></h1>
<p>Here we explain how to use storage mode of Mroonga</p>
<div class="section" id="how-to-use-full-text-search">
<h2>4.3.1. How to use full text search<a class="headerlink" href="#how-to-use-full-text-search" title="Permalink to this headline">¶</a></h2>
<p>After confirming the installation, let's create a table. The important point is to specify Mroonga by <code class="docutils literal"><span class="pre">ENGINE</span> <span class="pre">=</span> <span class="pre">Mroonga</span></code>.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; CREATE TABLE diaries (
    -&gt;   id INT PRIMARY KEY AUTO_INCREMENT,
    -&gt;   content VARCHAR(255),
    -&gt;   FULLTEXT INDEX (content)
    -&gt; ) ENGINE = Mroonga DEFAULT CHARSET utf8;
Query OK, 0 rows affected (0.10 sec)
</pre></div>
</div>
<p>We put data by INSERT.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; INSERT INTO diaries (content) VALUES (&quot;It&#39;ll be fine tomorrow.&quot;);
Query OK, 1 row affected (0.01 sec)

mysql&gt; INSERT INTO diaries (content) VALUES (&quot;It&#39;ll rain tomorrow&quot;);
Query OK, 1 row affected (0.00 sec)
</pre></div>
</div>
<p>Try full text search.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SELECT * FROM diaries WHERE MATCH(content) AGAINST(&quot;fine&quot;);
+----+-----------------------------------------+
| id | content                                 |
+----+-----------------------------------------+
|  1 | It&#39;ll be fine tomorrow. |
+----+-----------------------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>Yes, full text search works.</p>
</div>
<div class="section" id="how-to-get-search-score">
<h2>4.3.2. How to get search score<a class="headerlink" href="#how-to-get-search-score" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In version 1.0.0 or before, Mroonga used a special column named <code class="docutils literal"><span class="pre">_score</span></code> to get search score. From version 1.0.0, it follows MySQL's standard way to get search score.</p>
</div>
<p>We often want to display more relevant results first in full text search. We use search score in such case.</p>
<p>We can get search score by MySQL's standard way <a class="footnote-reference" href="#score" id="id1">[1]</a>, i.e. we use MATCH...AGAINST in one of columns in SELECT or ORDER BY.</p>
<p>Let's try.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; INSERT INTO diaries (content) VALUES (&quot;It&#39;s fine today. It&#39;ll be fine tomorrow as well.&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO diaries (content) VALUES (&quot;It&#39;s fine today. But it&#39;ll rain tomorrow.&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT *, MATCH (content) AGAINST (&quot;fine&quot;) FROM diaries WHERE MATCH (content) AGAINST (&quot;fine&quot;) ORDER BY MATCH (content) AGAINST (&quot;fine&quot;) DESC;
+----+--------------------------------------------------------------+------------------------------------+
| id | content                                                      | MATCH (content) AGAINST (&quot;fine&quot;) |
+----+--------------------------------------------------------------+------------------------------------+
|  3 | It&#39;s fine today. It&#39;ll be fine tomorrow as well. |                                  2 |
|  1 | It&#39;ll be fine tomorrow.                      |                                  1 |
|  4 | It&#39;s fine today. But it&#39;ll rain tomorrow.    |                                  1 |
+----+--------------------------------------------------------------+------------------------------------+
3 rows in set (0.00 sec)
</pre></div>
</div>
<p>The result having the search word <code class="docutils literal"><span class="pre">fine</span></code> more, i.e. <code class="docutils literal"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">3</span></code> message having the higher search score, is displayed first. And you also get search score by using MATCH AGAINST in SELECT phrase.</p>
<p>You can use <code class="docutils literal"><span class="pre">AS</span></code> to change the attribute name.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SELECT *, MATCH (content) AGAINST (&quot;fine&quot;) AS score FROM diaries WHERE MATCH (content) AGAINST (&quot;fine&quot;) ORDER BY MATCH (content) AGAINST (&quot;fine&quot;) DESC;
+----+--------------------------------------------------------------+-------+
| id | content                                                      | score |
+----+--------------------------------------------------------------+-------+
|  3 | It&#39;s fine today. It&#39;ll be fine tomorrow as well. |     2 |
|  1 | It&#39;ll be fine tomorrow.                      |     1 |
|  4 | It&#39;s fine today. But it&#39;ll rain tomorrow.    |     1 |
+----+--------------------------------------------------------------+-------+
3 rows in set (0.00 sec)
</pre></div>
</div>
</div>
<div class="section" id="how-to-specify-the-parser-for-full-text-search">
<h2>4.3.3. How to specify the parser for full text search<a class="headerlink" href="#how-to-specify-the-parser-for-full-text-search" title="Permalink to this headline">¶</a></h2>
<p>MySQL has the following syntax to specify the parser <a class="footnote-reference" href="#parser" id="id2">[2]</a> for full text search.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>FULLTEXT INDEX (content) WITH PARSER parser_name
</pre></div>
</div>
<p>To use this syntax, you need to register all parsers in MySQL beforehand. On the other hand, Groonga can dynamically add a tokenizer, that is a parser in MySQL. So if use this syntax in Mroonga, tokenizers that are added in Groonga dynamically cannot be supported. We think that this limitation decreases the convenience, and we choose our own syntax using COMMENT like the following.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>FULLTEXT INDEX (content) COMMENT &#39;parser &quot;TokenMecab&quot;&#39;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">COMMENT</span></code> in <code class="docutils literal"><span class="pre">FULLTEXT</span> <span class="pre">INDEX</span></code> is only supported MySQL 5.5 or later. If you use MySQL 5.1, use <code class="docutils literal"><span class="pre">mroonga_default_parser</span></code> variable described below.</p>
</div>
<p>You can specify one of following values as the parser.</p>
<dl class="docutils">
<dt>off</dt>
<dd>It does not tokenize at all. Use &quot;off&quot; if you want to treat <code class="docutils literal"><span class="pre">content</span></code> as is. For example, this value is used for prefix search.</dd>
<dt>TokenBigram</dt>
<dd><p class="first">It tokenises in bigram. But continuous alphabets, numbers or symbols are treated as a token. So there can exist tokes with 3 letters or more. It is to reduce noises.</p>
<p class="last">This is the default value.</p>
</dd>
<dt>TokenMecab</dt>
<dd>It tokenises using MeCab. Groonga should be built with MeCab support.</dd>
<dt>TokenBigramSplitSymbol</dt>
<dd><p class="first">It tokenises in bigram. Unlike TokenBigram, continuous symbols are not treated as a token, but tokenised in bigram.</p>
<p class="last">When you use TokenBigramSplitSymbol instead of TokenBigram, &quot;!?&quot; can match &quot;!?!?!?&quot; in &quot;Is it really!?!?!?&quot;. But when you use TokenBigram, only &quot;!?!?!?&quot; can match as well.</p>
</dd>
<dt>TokenBigramSplitSymbolAlpha</dt>
<dd><p class="first">It tokenise in bigram. In addition to TokenBigramSplitSymbol, continuous alphabets are not treated as a token either, but tokenised in bigram.</p>
<p class="last">When you use TokenBigramSplitSymbolAlpha instead of TokenBigram, &quot;real&quot; can match &quot;Is it really?&quot;. But when you use TokenBigram, only &quot;really&quot; can match as well.</p>
</dd>
<dt>TokenBigramSplitSymbolAlphaDigit</dt>
<dd><p class="first">It tokenise in bigram. In addition to TokenBigramSplitSymbolAlpha, continuous numbers are not treated as a token either, but tokenised in bigram. So any kind of characters are treated equally in bigram.</p>
<p class="last">When you use TokenBigramSplitSymbolAlphaDigit instead of TokenBigram, &quot;567&quot; can match &quot;090-0123-4567&quot;. But when you use TokenBigram, only &quot;4567&quot; can match as well.</p>
</dd>
<dt>TokenBigramIgnoreBlank</dt>
<dd><p class="first">It tokenise in bigram. Unlike TokenBigram, it ignores white spaces.</p>
<p class="last">When you use TokenBigramIgnoreBlank instead of TokenBigram, &quot;みなさん&quot; can match &quot;み な さ ん 注 目&quot;. But when you use TokenBigram, only &quot;み な さ ん&quot; can match as well.</p>
</dd>
<dt>TokenBigramIgnoreBlankSplitSymbol</dt>
<dd><p class="first">It tokenise in bigram. Unlike TokenBigramSplitSymbol, it ignores white spaces.</p>
<p class="last">When you use TokenBigramIgnoreBlankSplitSymbol instead of TokenBigramSplitSymbol, &quot;???&quot; can match &quot;! ? ???&quot;. But when you use TokenBigramSplitSymbol, only &quot;? ??&quot; can match as well.</p>
</dd>
<dt>TokenBigramIgnoreBlankSplitSymbolAlpha</dt>
<dd><p class="first">It tokenise in bigram. Unlike TokenBigramSplitSymbolAlpha, it ignores white spaces.</p>
<p class="last">When you use TokenBigramIgnoreBlankSplitSymbolAlpha instead of TokenBigramSplitSymbolAlpha, &quot;ama&quot; can match &quot;I am a pen.&quot;. But when you use TokenBigramSplitSymbolAlpha, only &quot;am a&quot; can match as well.</p>
</dd>
<dt>TokenBigramIgnoreBlankSplitSymbolAlphaDigit</dt>
<dd><p class="first">It tokenise in bigram. Unlike TokenBigramSplitSymbolAlphaDigit, it ignores white spaces.</p>
<p class="last">When you use TokenBigramIgnoreBlankSplitSymbolAlphaDigit instead of TokenBigramSplitSymbolAlphaDigit, &quot;9001&quot; can match &quot;090 0123 4567&quot;. But when you use TokenBigramSplitSymbolAlphaDigit, only &quot;90 01&quot; can match as well.</p>
</dd>
<dt>TokenDelimit</dt>
<dd><p class="first">It tokenise by splitting with a white space.</p>
<p class="last">&quot;movie horror topic&quot; will be tokenised as &quot;movie&quot;, &quot;horror&quot;, &quot;topic&quot;.</p>
</dd>
<dt>TokenDelimitNull</dt>
<dd><p class="first">It tokenise by splitting with a null character (\0).</p>
<p class="last">&quot;movie\0horror\0topic&quot; will be tokenised as &quot;movie&quot;, &quot;horror&quot;, &quot;topic&quot;.</p>
</dd>
<dt>TokenUnigram</dt>
<dd>It tokenises in unigram. But continuous alphabets, numbers or symbols are treated as a token. So there can exist tokes with 2 letters or more. It is to reduce noises.</dd>
<dt>TokenTrigram</dt>
<dd>It tokenises in trigram. But continuous alphabets, numbers or symbols are treated as a token. So there can exist tokes with 4 letters or more. It is to reduce noises.</dd>
</dl>
<p>You can specify the default parser by passing <code class="docutils literal"><span class="pre">--with-default-parser</span></code> option in <code class="docutils literal"><span class="pre">configure</span></code> when you build mroonga</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./configure --with-default-parser TokenMecab ...
</pre></div>
</div>
<p>Or you can set <code class="docutils literal"><span class="pre">mroonga_default_parser</span></code> variable in my.cnf or by SQL. If you specify it in my.cnf, the change will not be lost after restarting MySQL, but you need to restart MySQL to make it effective. On the other hand, if you set it in SQL, the change is effective immediately, but it will be lost when you restart MySQL.</p>
<p>my.cnf:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[mysqld]
mroonga_default_parser=TokenMecab
</pre></div>
</div>
<p>SQL:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SET GLOBAL mroonga_default_parser = TokenMecab;
Query OK, 0 rows affected (0.00 sec)
</pre></div>
</div>
</div>
<div class="section" id="how-to-specify-the-normalizer">
<h2>4.3.4. How to specify the normalizer<a class="headerlink" href="#how-to-specify-the-normalizer" title="Permalink to this headline">¶</a></h2>
<p>Mroonga uses normalizer corresponding to the encoding of document.
It is used when tokenizing text and storing table key.</p>
<p>It is used <code class="docutils literal"><span class="pre">NormalizerMySQLGeneralCI</span></code> normalizer when the encoding is
<code class="docutils literal"><span class="pre">utf8_general_ci</span></code> or <code class="docutils literal"><span class="pre">utf8mb4_general_ci</span></code>.</p>
<p>It is used <code class="docutils literal"><span class="pre">NormalizerMySQLUnicodeCI</span></code> normalizer when the encoding is
<code class="docutils literal"><span class="pre">utf8_unicode_ci</span></code> or <code class="docutils literal"><span class="pre">utf8mb4_unicode_ci</span></code>.</p>
<p>It isn't used normalizer when the encoding is <code class="docutils literal"><span class="pre">utf8_bin</span></code>.</p>
<p>Here is an example that uses <code class="docutils literal"><span class="pre">NormalizerMySQLUnicodeCI</span></code> normalizer by specifying <code class="docutils literal"><span class="pre">utf8_unicode_ci</span></code>.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SET NAMES utf8;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; CREATE TABLE diaries (
    -&gt;   day DATE PRIMARY KEY,
    -&gt;   content VARCHAR(64) NOT NULL,
    -&gt;   FULLTEXT INDEX (content)
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
Query OK, 0 rows affected (0.18 sec)

mysql&gt; INSERT INTO diaries VALUES (&quot;2013-04-23&quot;, &quot;ブラックコーヒーを飲んだ。&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ふらつく&quot; IN BOOLEAN MODE);
+------------+-----------------------------------------+
| day        | content                                 |
+------------+-----------------------------------------+
| 2013-04-23 | ブラックコーヒーを飲んだ。 |
+------------+-----------------------------------------+
1 row in set (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ﾌﾞﾗｯｸ&quot; IN BOOLEAN MODE);
+------------+-----------------------------------------+
| day        | content                                 |
+------------+-----------------------------------------+
| 2013-04-23 | ブラックコーヒーを飲んだ。 |
+------------+-----------------------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>Mroonga has the following syntax to specify Groonga's normalizer:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>FULLTEXT INDEX (content) COMMENT &#39;normalizer &quot;NormalizerAuto&quot;&#39;
</pre></div>
</div>
<p>See <a class="reference external" href="http://groonga.org/docs/reference/normalizers.html">Groonga's document</a> document about Groonga's normalizer.</p>
<p>Here is an example that uses <code class="docutils literal"><span class="pre">NormalizerAuto</span></code> normalizer:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SET NAMES utf8;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; CREATE TABLE diaries (
    -&gt;   day DATE PRIMARY KEY,
    -&gt;   content VARCHAR(64) NOT NULL,
    -&gt;   FULLTEXT INDEX (content) COMMENT &#39;normalizer &quot;NormalizerAuto&quot;&#39;
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
Query OK, 0 rows affected (0.19 sec)

mysql&gt; INSERT INTO diaries VALUES (&quot;2013-04-23&quot;, &quot;ブラックコーヒーを飲んだ。&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ふらつく&quot; IN BOOLEAN MODE);
Empty set (0.00 sec)

mysql&gt; SELECT * FROM diaries
    -&gt;        WHERE MATCH (content) AGAINST (&quot;+ﾌﾞﾗｯｸ&quot; IN BOOLEAN MODE);
+------------+-----------------------------------------+
| day        | content                                 |
+------------+-----------------------------------------+
| 2013-04-23 | ブラックコーヒーを飲んだ。 |
+------------+-----------------------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
</div>
<div class="section" id="how-to-specify-the-token-filters">
<h2>4.3.5. How to specify the token filters<a class="headerlink" href="#how-to-specify-the-token-filters" title="Permalink to this headline">¶</a></h2>
<p>Mroonga has the following syntax to specify Groonga's token filters.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>FULLTEXT INDEX (content) COMMENT &#39;token_filters &quot;TokenFilterStem&quot;&#39;
</pre></div>
</div>
<p>Here is an example that uses <code class="docutils literal"><span class="pre">TokenFilterStem</span></code> token filter.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SELECT mroonga_command(&#39;register token_filters/stem&#39;);
+------------------------------------------------+
| mroonga_command(&#39;register token_filters/stem&#39;) |
+------------------------------------------------+
| true                                           |
+------------------------------------------------+
1 row in set (0.00 sec)

mysql&gt; CREATE TABLE memos (
    -&gt; id INT NOT NULL PRIMARY KEY,
    -&gt; content TEXT NOT NULL,
    -&gt; FULLTEXT INDEX (content) COMMENT &#39;normalizer &quot;NormalizerAuto&quot;, token_filters &quot;TokenFilterStem&quot;&#39;
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8;
Query OK, 0 rows affected (0.18 sec)

mysql&gt; INSERT INTO memos VALUES (1, &quot;I develop Groonga&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (2, &quot;I&#39;m developing Groonga&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (3, &quot;I developed Groonga&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM memos
    -&gt; WHERE MATCH (content) AGAINST (&quot;+develops&quot; IN BOOLEAN MODE);
+----+------------------------+
| id | content                |
+----+------------------------+
|  1 | I develop Groonga      |
|  2 | I&#39;m developing Groonga |
|  3 | I developed Groonga    |
+----+------------------------+
3 rows in set (0.01 sec)
</pre></div>
</div>
<p>See <a class="reference external" href="http://groonga.org/docs/reference/token_filters.html">Groonga's document</a> document about Groonga's token filter.</p>
<p>Here is an example that uses <code class="docutils literal"><span class="pre">TokenFilterStopWord</span></code> token filter.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SELECT mroonga_command(&quot;register token_filters/stop_word&quot;);
+-----------------------------------------------------+
| mroonga_command(&quot;register token_filters/stop_word&quot;) |
+-----------------------------------------------------+
| true                                                |
+-----------------------------------------------------+
1 row in set (0.00 sec)

mysql&gt; CREATE TABLE terms (
    -&gt;   term VARCHAR(64) NOT NULL PRIMARY KEY,
    -&gt;   is_stop_word BOOL NOT NULL
    -&gt; ) Engine=Mroonga COMMENT=&#39;default_tokenizer &quot;TokenBigram&quot;, token_filters &quot;TokenFilterStopWord&quot;&#39; DEFAULT CHARSET=utf8;
Query OK, 0 rows affected (0.12 sec)

mysql&gt; CREATE TABLE memos (
    -&gt;   id INT NOT NULL PRIMARY KEY,
    -&gt;   content TEXT NOT NULL,
    -&gt;   FULLTEXT INDEX (content) COMMENT &#39;table &quot;terms&quot;&#39;
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8;
Query OK, 0 rows affected (0.17 sec)

mysql&gt;
mysql&gt; INSERT INTO terms VALUES (&quot;and&quot;, true);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (1, &quot;Hello&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (2, &quot;Hello and Good-bye&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (3, &quot;Good-bye&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM memos
    -&gt;   WHERE MATCH (content) AGAINST (&quot;+\&quot;Hello and\&quot;&quot; IN BOOLEAN MODE);
+----+--------------------+
| id | content            |
+----+--------------------+
|  1 | Hello              |
|  2 | Hello and Good-bye |
+----+--------------------+
2 rows in set (0.01 sec)
</pre></div>
</div>
<p>It's used that specifying the lexicon table for fulltext search.</p>
</div>
<div class="section" id="how-to-specify-groonga-s-column-flags">
<h2>4.3.6. How to specify Groonga's column flags<a class="headerlink" href="#how-to-specify-groonga-s-column-flags" title="Permalink to this headline">¶</a></h2>
<p>Mroonga has the following syntax to specify Groonga's column flags:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>content TEXT COMMENT &#39;flags &quot;COLUMN_SCALAR|COMPRESS_ZLIB&quot;&#39;
</pre></div>
</div>
<p>Here is an example that uses <code class="docutils literal"><span class="pre">COMPRESS_ZLIB</span></code> flag.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; CREATE TABLE entries (
    -&gt;   id INT UNSIGNED PRIMARY KEY,
    -&gt;   content TEXT COMMENT &#39;flags &quot;COLUMN_SCALAR|COMPRESS_ZLIB&quot;&#39;
    -&gt; ) Engine=Mroonga DEFAULT CHARSET=utf8;
Query OK, 0 rows affected (0.12 sec)
</pre></div>
</div>
<p>See <a class="reference external" href="http://groonga.org/docs/reference/commands/column_create.html#parameters">Groonga's document</a> document about Groonga's column flags.</p>
</div>
<div class="section" id="how-to-use-geolocation-search">
<h2>4.3.7. How to use geolocation search<a class="headerlink" href="#how-to-use-geolocation-search" title="Permalink to this headline">¶</a></h2>
<p>In storage mode, you can use fast geolocation search in addition to full text search. But unlike MyISAM, you can only store POINT type data. You cannot store other types data like LINE. And fast search using index only supports MBRContains. It does not support MBRDisjoint.</p>
<p>For the table definition for geolocation search, you need to define a POINT type column like in MyISAM and define SPATIAL INDEX for it.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; CREATE TABLE shops (
    -&gt;   id INT PRIMARY KEY AUTO_INCREMENT,
    -&gt;   name VARCHAR(255),
    -&gt;   location POINT NOT NULL,
    -&gt;   SPATIAL INDEX (location)
    -&gt; ) ENGINE = Mroonga;
Query OK, 0 rows affected (0.06 sec)
</pre></div>
</div>
<p>To store data, you create POINT type data by using geomFromText() function like in MyISAM.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; INSERT INTO shops VALUES (null, &#39;Nezu\&#39;s Taiyaki&#39;, GeomFromText(&#39;POINT(139.762573 35.720253)&#39;));
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO shops VALUES (null, &#39;Naniwaya&#39;, GeomFromText(&#39;POINT(139.796234 35.730061)&#39;));
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO shops VALUES (null, &#39;Yanagiya Taiyaki&#39;, GeomFromText(&#39;POINT(139.783981 35.685341)&#39;));
Query OK, 1 row affected (0.00 sec)
</pre></div>
</div>
<p>If you want to find shops within the rectangle where Ikebukuro station (139.7101 35.7292) is the top-left point and Tokyo Station (139.7662 35.6815) is the bottom-right point, SELECT phrase is like the following.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SELECT id, name, AsText(location) FROM shops WHERE MBRContains(GeomFromText(&#39;LineString(139.7101 35.7292, 139.7662 35.6815)&#39;), location);
+----+-----------------------+------------------------------------------+
| id | name                  | AsText(location)                         |
+----+-----------------------+------------------------------------------+
|  1 | Nezu&#39;s Taiyaki | POINT(139.762572777778 35.7202527777778) |
+----+-----------------------+------------------------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>Here you can search by geolocation!</p>
</div>
<div class="section" id="how-to-get-the-record-id">
<h2>4.3.8. How to get the record ID<a class="headerlink" href="#how-to-get-the-record-id" title="Permalink to this headline">¶</a></h2>
<p>Groonga assigns a unique number to identify the record when a record is added in the table.</p>
<p>To make the development of applications easier, you can get this record ID by SQL in Mroonga</p>
<p>To get the record ID, you need to create a column named <code class="docutils literal"><span class="pre">_id</span></code> when you create a table.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; CREATE TABLE memos (
    -&gt;   _id INT,
     &gt;   content VARCHAR(255),
    -&gt;   UNIQUE KEY (_id) USING HASH
    -&gt; ) ENGINE = Mroonga;
Query OK, 0 rows affected (0.04 sec)
</pre></div>
</div>
<p>Tye typo of _id column should be integer one (TINYINT, SMALLINT, MEDIUMINT, INT or BIGINT).</p>
<p>You can create an index for _id column, but it should be HASH type.</p>
<p>Let's add records in the table by INSERT. Since _id column is implemented as a virtual column and its value is assigned by Groonga, you cannot specify the value when updating.
So you need to exclude it from setting columns, or you need to use <code class="docutils literal"><span class="pre">null</span></code> as its value.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; INSERT INTO memos VALUES (null, &quot;Saury for today&#39;s dinner.&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (null, &quot;Update mroonga tomorrow.&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (null, &quot;Buy some dumpling on the way home.&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO memos VALUES (null, &quot;Thank God It&#39;s meat day.&quot;);
Query OK, 1 row affected (0.00 sec)
</pre></div>
</div>
<p>To get the record ID, you invoke SELECT with _id column.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SELECT * FROM memos;
+------+------------------------------------------+
| _id  | content                                  |
+------+------------------------------------------+
|    1 | Saury for today&#39;s dinner.                    |
|    2 | Update mroonga tomorrow. |
|    3 | Buy some dumpling on the way home.                 |
|    4 | Thank God It&#39;s meat day.                 |
+------+------------------------------------------+
4 rows in set (0.00 sec)
</pre></div>
</div>
<p>By using last_insert_grn_id function, you can also get the record ID that is assigned by the last INSERT.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; INSERT INTO memos VALUES (null, &quot;Just one bottle of milk in the fridge.&quot;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT last_insert_grn_id();
+----------------------+
| last_insert_grn_id() |
+----------------------+
|                    5 |
+----------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>last_insert_grn_id function is included in Mroonga as a User-Defined Function (UDF), but if you have not yet register it in MySQL by CREATE FUNCTION, you need to invoke the following SQL for defining a function.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; CREATE FUNCTION last_insert_grn_id RETURNS INTEGER SONAME &#39;ha_mroonga.so&#39;;
</pre></div>
</div>
<p>As you can see in the example above, you can get the record ID by _id column or last_insert_grn_id function. It will be useful to use this value in the ensuing SQL queries like UPDATE.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; UPDATE memos SET content = &quot;So much milk in the fridge.&quot; WHERE _id = last_insert_grn_id();
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0
</pre></div>
</div>
</div>
<div class="section" id="how-to-get-snippet-keyword-in-context">
<h2>4.3.9. How to get snippet (Keyword in context)<a class="headerlink" href="#how-to-get-snippet-keyword-in-context" title="Permalink to this headline">¶</a></h2>
<p>Mroonga provides functionality to get keyword in context.
It is implemented as <a class="reference internal" href="../reference/udf/mroonga_snippet.html"><span class="doc">mroonga_snippet()</span></a> UDF.</p>
</div>
<div class="section" id="how-to-run-groonga-command">
<h2>4.3.10. How to run Groonga command<a class="headerlink" href="#how-to-run-groonga-command" title="Permalink to this headline">¶</a></h2>
<p>In storage mode, Mroonga stores all your data into Groonga
database. You can access Groonga database by SQL with Mroonga. SQL is
very powerful but it is not good for some operations such as faceted
search.</p>
<p>Faceted search is popular recently. Many online shopping sites such as
amazon.com and ebay.com support faceted search. Faceted search refines
the current search by available search parameters before users refine
their search. And faceted search shows refined searches. Users just
select a refined search. Users benefit from faceted search:</p>
<ul class="simple">
<li>Users don't need to think about how to refine their search.
Users just select a showed refined search.</li>
<li>Users don't get boared &quot;not match&quot; page. Faceted search showes only
refined searches that has one or more matched items.</li>
</ul>
<p>Faceted search needs multiple <cite>GROUP BY</cite> operations against searched
result set. To do faceted search by SQL, multiple <cite>SELECT</cite> requests
are needed. It is not effective.</p>
<p>Groonga can do faceted search by only one groonga command. It is
effective. Groonga has the <cite>select</cite> command that can search records
with faceted search. Faceted search is called as <cite>drilldown</cite> in
Groonga. See <a class="reference external" href="http://groonga.org/docs/reference/commands/select.html">Groonga's document</a> about
Groonga's <cite>select</cite> command.</p>
<p>Mroonga provides <cite>mroonga_command()</cite> function. You can run groonga
command in SQL by the function. But you should use only <cite>select</cite>
command. Other commands that change schema or data may break
consistency.</p>
<p>Here is the schema definition for execution examples:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>CREATE TABLE diaries (
  id INT PRIMARY KEY AUTO_INCREMENT,
  content VARCHAR(255),
  date DATE,
  year YEAR,
  `year_month` VARCHAR(9),
  tag VARCHAR(32),
  FULLTEXT INDEX (content)
) ENGINE = Mroonga DEFAULT CHARSET utf8;
</pre></div>
</div>
<p>Here is the sample data for execution examples:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>INSERT INTO diaries (content, date, year, `year_month`, tag)
       VALUES (&#39;Groonga is an open-source fulltext search engine and column store.&#39;,
               &#39;2013-04-08&#39;,
               &#39;2013&#39;,
               &#39;2013-04&#39;,
               &#39;groonga&#39;);
INSERT INTO diaries (content, date, year, `year_month`, tag)
       VALUES (&#39;Mroonga is an open-source storage engine for fast fulltext search with MySQL.&#39;,
               &#39;2013-04-09&#39;,
               &#39;2013&#39;,
               &#39;2013-04&#39;,
               &#39;MySQL&#39;);
INSERT INTO diaries (content, date, year, `year_month`, tag)
       VALUES (&#39;Tritonn is a patched version of MySQL that supports better fulltext search function with Senna.&#39;,
               &#39;2013-03-29&#39;,
               &#39;2013&#39;,
               &#39;2013-03&#39;,
               &#39;MySQL&#39;);
</pre></div>
</div>
<p>Each record has <cite>groonga</cite> or <cite>MySQL</cite> as <cite>tag</cite>. Each record also has
<cite>year</cite> and <cite>year_month</cite>. You can use <cite>tag</cite>, <cite>year</cite> and <cite>year_month</cite> as
faceted search keys.</p>
<p>Groonga calls faceted search as drilldown. So parameter key in Groonga
is <cite>--drilldown</cite>. Groonga returns search result as JSON. So
<cite>mroonga_command()</cite> also returns search result as JSON. It is not SQL
friendly. You need to parse search result JSON by yourself.</p>
<p>Here is the example of faceted search by all available faceted search
keys (result JSON is pretty printted):</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>SELECT mroonga_command(&quot;select diaries --output_columns _id --limit 0 --drilldown tag,year,year_month&quot;) AS faceted_result;
+-----------------------------+
| faceted_result              |
+-----------------------------+
| [[[3],                      |
|   [[&quot;_id&quot;,&quot;UInt32&quot;]]],      |
|  [[2],                      |
|   [[&quot;_key&quot;,&quot;ShortText&quot;],    |
|    [&quot;_nsubrecs&quot;,&quot;Int32&quot;]],  |
|   [&quot;groonga&quot;,1],            |
|   [&quot;MySQL&quot;,2]],             |
|  [[1],                      |
|   [[&quot;_key&quot;,&quot;Time&quot;],         |
|    [&quot;_nsubrecs&quot;,&quot;Int32&quot;]],  |
|   [1356998400.0,3]],        |
|  [[2],                      |
|   [[&quot;_key&quot;,&quot;ShortText&quot;],    |
|    [&quot;_nsubrecs&quot;,&quot;Int32&quot;]],  |
|   [&quot;2013-04&quot;,2],            |
|   [&quot;2013-03&quot;,1]]]           |
+-----------------------------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>See <a class="reference external" href="http://groonga.org/docs/reference/commands/select.html">Groonga's select command document</a> for more
details.</p>
</div>
<div class="section" id="logging">
<h2>4.3.11. Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>Mroonga outputs the logs by default.</p>
<p>Log files are located in MySQL's data directory with the filename  <code class="docutils literal"><span class="pre">groonga.log</span></code>.</p>
<p>Here is the example of the log.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>2010-10-07 17:32:39.209379|n|b1858f80|mroonga 1.10 started.
2010-10-07 17:32:44.934048|d|46953940|hash get not found (key=test)
2010-10-07 17:32:44.936113|d|46953940|hash put (key=test)
</pre></div>
</div>
<p>The default log level is NOTICE, i.e. we have important information only and we don't have debug information etc.).</p>
<p>You can get the log level by <code class="docutils literal"><span class="pre">mroonga_log_level</span></code> system variable, that is a global variable. You can also modify it dynamically by using SET phrase.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mysql&gt; SHOW VARIABLES LIKE &#39;mroonga_log_level&#39;;
+-------------------+--------+
| Variable_name     | Value  |
+-------------------+--------+
| mroonga_log_level | NOTICE |
+-------------------+--------+
1 row in set (0.00 sec)

mysql&gt; SET GLOBAL mroonga_log_level=DUMP;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; SHOW VARIABLES LIKE &#39;mroonga_log_level&#39;;
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| mroonga_log_level | DUMP  |
+-------------------+-------+
1 row in set (0.00 sec)
</pre></div>
</div>
<p>Available log levels are the followings.</p>
<ul class="simple">
<li>NONE</li>
<li>EMERG</li>
<li>ALERT</li>
<li>CRIT</li>
<li>ERROR</li>
<li>WARNING</li>
<li>NOTICE</li>
<li>INFO</li>
<li>DEBUG</li>
<li>DUMP</li>
</ul>
<p>See <a class="reference internal" href="../reference/server_variables.html#server-variable-mroonga-log-level"><span class="std std-ref">mroonga_log_level</span></a> about details.</p>
<p>You can reopen the log file by FLUSH LOGS. If you want to rotate the log file without stopping MySQL server, you can do in the following procedure.</p>
<ol class="arabic simple">
<li>change the file name of <code class="docutils literal"><span class="pre">groonga.log</span></code> (by using OS's mv command etc.).</li>
<li>invoke &quot;FLUSH LOGS&quot; in MySQL server (by mysql command or mysqladmin command).</li>
</ol>
</div>
<div class="section" id="next-step">
<h2>4.3.12. Next step<a class="headerlink" href="#next-step" title="Permalink to this headline">¶</a></h2>
<p>Now, you can use Mroonga as storage mode! If you want Mroonga to be
faster, see also <a class="reference internal" href="../reference/optimizations.html"><span class="doc">Optimizations</span></a>.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="score" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://dev.mysql.com/doc/refman/5.1/ja/fulltext-search.html">MySQL 5.1 Reference Manual :: 11 Functions and Operations :: 11.7 Full-Text Search Functions</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="parser" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>In groonga, we call it a 'tokenizer'.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.3. Storage mode</a><ul>
<li><a class="reference internal" href="#how-to-use-full-text-search">4.3.1. How to use full text search</a></li>
<li><a class="reference internal" href="#how-to-get-search-score">4.3.2. How to get search score</a></li>
<li><a class="reference internal" href="#how-to-specify-the-parser-for-full-text-search">4.3.3. How to specify the parser for full text search</a></li>
<li><a class="reference internal" href="#how-to-specify-the-normalizer">4.3.4. How to specify the normalizer</a></li>
<li><a class="reference internal" href="#how-to-specify-the-token-filters">4.3.5. How to specify the token filters</a></li>
<li><a class="reference internal" href="#how-to-specify-groonga-s-column-flags">4.3.6. How to specify Groonga's column flags</a></li>
<li><a class="reference internal" href="#how-to-use-geolocation-search">4.3.7. How to use geolocation search</a></li>
<li><a class="reference internal" href="#how-to-get-the-record-id">4.3.8. How to get the record ID</a></li>
<li><a class="reference internal" href="#how-to-get-snippet-keyword-in-context">4.3.9. How to get snippet (Keyword in context)</a></li>
<li><a class="reference internal" href="#how-to-run-groonga-command">4.3.10. How to run Groonga command</a></li>
<li><a class="reference internal" href="#logging">4.3.11. Logging</a></li>
<li><a class="reference internal" href="#next-step">4.3.12. Next step</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mode.html"
                        title="previous chapter">4.2. Mode</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="wrapper.html"
                        title="next chapter">4.4. Wrapper mode</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../sources/tutorial/storage.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="wrapper.html" title="4.4. Wrapper mode"
             >next</a> |</li>
        <li class="right" >
          <a href="mode.html" title="4.2. Mode"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mroonga v6.02 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" >4. Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2009-2016, Mroonga Project.
    </div>
      <script src="http://connect.facebook.net/en_US/all.js"></script>

    <script>
      FB.init({
         appId  : null,
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
         xfbml  : true  // parse XFBML
      });
    </script>
  </body>

</html>