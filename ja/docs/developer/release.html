<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>9.2. Release procedure &#8212; Mroonga v9.10 documentation</title>
    <link rel="stylesheet" href="../static/mroonga.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/language_data.js"></script>
    <script type="text/javascript" src="../static/translations.js"></script>
    
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="9.3. コーディングスタイル" href="coding_style.html" />
    <link rel="prev" title="9.1. デバッグ方法" href="debug.html" /> 
      <meta property="fb:page_id" content="238184682903165" /><!-- mroonga -->
    <meta property="fb:admins" content="664204556" /><!-- kouhei.sutou -->
    <meta property="og:type" content="product" />
    <meta property="og:image" content="http://mroonga.org/images/logos/mroonga-icon-full-size.png" />
    <meta property="og:site_name" content="mroonga" />

    <link rel="stylesheet" href="/css/sphinx.css" type="text/css" />
  </head>
  <body>
    <div id="fb-root"></div>

<div class="header">
  <h1 class="title">
    <a id="top-link" href="../../">
      <span class="project">mroonga</span>
      <span class="separator">-</span>
      <span class="description">MySQLで高速に全文検索するためのオープンソースのストレージエンジン</span>
    </a>
  </h1>

      <div class="facebook-buttons">
      <fb:like href="http://www.facebook.com/pages/mroonga/238184682903165"
               layout="standard"
               width="290"></fb:like>
    </div>
    <div class="other-language-links">

    <ul>
      <li><a href="../../../docs/developer/release.html" title="English">English</a></li>
    </ul>
  </div>
</div>
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="coding_style.html" title="9.3. コーディングスタイル"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="debug.html" title="9.1. デバッグ方法"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mroonga v9.10 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../developer.html" accesskey="U">9. 開発者向け情報</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="release-procedure">
<h1>9.2. Release procedure<a class="headerlink" href="#release-procedure" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="requirements">
<h2>9.2.1. 必要なもの<a class="headerlink" href="#requirements" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下はリリース手順に必要なものです。</p>
<ul class="simple">
<li><p>Debian GNU/Linux (sid)</p></li>
<li><p>zshをユーザーシェルとして使います</p></li>
</ul>
<p>以下の作業ディレクトリを使います。</p>
<ul class="simple">
<li><p>MROONGA_DIR=$HOME/work/mroonga</p></li>
<li><p>MROONGA_CLONE_DIR=$HOME/work/mroonga/mroonga.clean</p></li>
<li><p>MROONGA_GITHUB_COM_PATH=$HOME/work/mroonga/mroonga.github.com</p></li>
<li><p>CUTTER_DIR=$HOME/work/cutter</p></li>
<li><p>CUTTER_SOURCE_PATH=$HOME/work/cutter/cutter</p></li>
<li><p>GROONGA_SOURCE_PATH=$HOME/work/groonga/groonga.clean</p></li>
</ul>
</div>
<div class="section" id="setup-build-environment">
<h2>9.2.2. ビルド環境をセットアップする<a class="headerlink" href="#setup-build-environment" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下のパッケージをインストールします:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% sudo apt-get install -V ruby mecab libmecab-dev gnupg2 dh-autoreconf python-sphinx bison
</pre></div>
</div>
<p>We use <a class="reference external" href="https://www.vagrantup.com/">Vagrant</a> for building deb or rpm packages and expect that Virtualbox package is already installed. If not, please install it in the following steps:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% cat /etc/apt/sources.list
deb http://ftp.jp.debian.org/debian/ sid main contrib
deb-src http://ftp.jp.debian.org/debian/ sid main contrib
% sudo apt-get update
% sudo apt-get install virtualbox
</pre></div>
</div>
</div>
<div class="section" id="bump-version">
<h2>9.2.3. バージョンをあげる<a class="headerlink" href="#bump-version" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>最新のリリースへバージョンをあげる</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make update-version NEW_VERSION_MAJOR=9 NEW_VERSION_MINOR=1 NEW_VERSION_MICRO=0
</pre></div>
</div>
</div>
<div class="section" id="describe-the-changes">
<h2>9.2.4. 変更点を記述する<a class="headerlink" href="#describe-the-changes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>前回のリリース以降の最近の変更点を <code class="docutils literal notranslate"><span class="pre">doc/source/news.rst</span></code> へまとめます。このまとめはリリースノートでも使います。</p>
<p>以下のコマンドを前回のリリースからの変更点を収集するのに使います:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% git log -p --reverse $(git tag | tail -1)..
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">^commit</span></code> でログを検索し、主な変更点を拾います。</p>
<p>含めるべきもの</p>
<ul class="simple">
<li><p>ユーザーに影響のある変更点</p></li>
<li><p>互換性を壊すような変更点</p></li>
</ul>
<p>含めるべきでないもの</p>
<ul class="simple">
<li><p>ユーザーに影響のない内部的な変更やリファクタリング</p></li>
</ul>
</div>
<div class="section" id="generate-configure-script">
<h2>9.2.5. configureスクリプトの生成<a class="headerlink" href="#generate-configure-script" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>masterブランチはconfigureスクリプトを含んでいないのでビルドするのにconfigureスクリプトを生成する必要があります。</p>
<p><code class="docutils literal notranslate"><span class="pre">autogen.sh</span></code> を以下のコマンドで実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% sh autogen.sh
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">configure</span></code> スクリプトを生成します。</p>
</div>
<div class="section" id="execute-configure-script">
<h2>9.2.6. configureスクリプトの実行<a class="headerlink" href="#execute-configure-script" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Makefile</span></code> を生成するために、 <code class="docutils literal notranslate"><span class="pre">configure</span></code> スクリプトを実行します。</p>
<p>リリース向けに以下のオプションとともに実行します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% ./configure \
    --enable-document \
    --prefix=/tmp/local \
    --with-launchpad-uploader-pgp-key=(Launchpadに登録したkeyID) \
    --with-mroonga-github-com-path=$MROONGA_GITHUB_COM_PATH \
    --with-cutter-source-path=$CUTTER_SOURCE_PATH \
    --with-groonga-source-path=$GROONGA_SOURCE_PATH \
    --with-mysql-source=(The directory of MySQL source code) \
    --with-mysql-build=(The build directory of MySQL) \
    --with-mysql-config=(The path to mysql_config command)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--with-mysql-source</span></code> の詳細については <a class="reference internal" href="../install/others.html"><span class="doc">その他</span></a>  を参照してください。</p>
</div>
<div class="section" id="check-whether-you-can-upload-packages">
<h2>9.2.7. パッケージをアップロード可能か確認する<a class="headerlink" href="#check-whether-you-can-upload-packages" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>pacakgesユーザーでpackages.groonga.orgにログインできるかを確認します。</p>
<p>ログインできるかどうかは以下のコマンドで確認できます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% ssh packages@packages.groonga.org
</pre></div>
</div>
<p>packages.groonga.orgにログインできないときは、sshの公開かぎを登録しておかないといけません。</p>
</div>
<div class="section" id="execute-make-update-latest-release">
<h2>9.2.8. make update-latest-releaseを実行する<a class="headerlink" href="#execute-make-update-latest-release" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">update-latest-release</span></code> を OLD_RELEASE_DATE や NEW_RELEASE_DATE とともに実行します。</p>
<p>9.09 のリリースの際は、以下のコマンドを実行しました。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make update-latest-release OLD_RELEASE=9.09 OLD_RELEASE_DATE=2019-09-27 NEW_RELEASE_DATE=2019-10-30
</pre></div>
</div>
<p>このコマンドはMroongaのサイトのHTMLファイルやspecやdebian/changelogファイルのバージョンを更新します。</p>
</div>
<div class="section" id="tagging-for-release">
<h2>9.2.9. リリースのためのタグ打ち<a class="headerlink" href="#tagging-for-release" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>タグを打つためにイアkのコマンドを実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make tag
% git push --tags origin
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>リリースのためにタグを打ったら、<code class="docutils literal notranslate"><span class="pre">confiugre</span></code> スクリプトを実行します。このタグの情報はドキュメントを生成するときに反映されます。</p>
</div>
</div>
<div class="section" id="upload-archive-files">
<h2>9.2.10. アーカイブファイルのアップロード<a class="headerlink" href="#upload-archive-files" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>次に配布用のアーカイブファイル(<code class="docutils literal notranslate"><span class="pre">tar.gz</span></code>)を作成します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make dist
</pre></div>
</div>
<p>作業ディレクトリを <code class="docutils literal notranslate"><span class="pre">packages/source</span></code> に変更します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% cd packages/source
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">download</span></code> を実行し、同期します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make download
</pre></div>
</div>
<p>ソースアーカイブを生成するために、 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">archive</span></code> を実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make archive
</pre></div>
</div>
<p>アーカイブファイルをアップロードするために、<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">upload</span></code> を実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make upload
</pre></div>
</div>
<p>結果として、 <code class="docutils literal notranslate"><span class="pre">tar.gz</span></code> アーカイブ・ファイルが <a class="reference external" href="https://packages.groonga.org/source/mroonga">https://packages.groonga.org/source/mroonga</a>/から入手可能になります。</p>
</div>
<div class="section" id="create-packages-for-the-release">
<h2>9.2.11. リリース向けにパッケージを作成する<a class="headerlink" href="#create-packages-for-the-release" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>LinuxとWindowsのパッケージを作成します。</p>
<div class="section" id="debian">
<h3>9.2.11.1. Debian<a class="headerlink" href="#debian" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>作業ディレクトリを <code class="docutils literal notranslate"><span class="pre">apt</span></code> に変更します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% cd apt
</pre></div>
</div>
<p>以下のコマンドを実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make download
% make build
% make upload
</pre></div>
</div>
<p>パッケージをアップロードした後、署名やメタデータを更新します。詳細はGroongaのリリース手順を参照してください。</p>
</div>
<div class="section" id="debian-derivatives-ubuntu">
<h3>9.2.11.2. Debian系(Ubuntu)<a class="headerlink" href="#debian-derivatives-ubuntu" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Ubuntuの場合、パッケージはlaunchpad.netのPPAで提供されます。</p>
<p>作業ディレクトリを <code class="docutils literal notranslate"><span class="pre">ubuntu</span></code> にし、<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">upload</span></code> コマンドを実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% cd packages/ubuntu
% make upload
</pre></div>
</div>
<p>パッケージのアップロードに成功すると、パッケージのビルドがlaunchpad.netにて行われます。アップロードに成功するとメールで通知が届きます。ビルドが成功するとパッケージをPPA経由でインストールできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* https://launchpad.net/~groonga/+archive/ubuntu/ppa
</pre></div>
</div>
</div>
<div class="section" id="red-hat-derivatives">
<h3>9.2.11.3. Red Hat系<a class="headerlink" href="#red-hat-derivatives" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>作業ディレクトリを <code class="docutils literal notranslate"><span class="pre">yum</span></code> に変更します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% cd apt
</pre></div>
</div>
<p>以下のコマンドを実行します:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% make download
% make build
% make upload
</pre></div>
</div>
<p>パッケージをアップロードした後、署名やメタデータを更新します。詳細はGroongaのリリース手順を参照してください。</p>
</div>
<div class="section" id="windows">
<h3>9.2.11.4. Windows<a class="headerlink" href="#windows" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Windows向けには、 <a class="reference external" href="https://ci.appveyor.com/project/groonga/mroonga">AppVeyor CI</a> の成果物を使っています。</p>
</div>
</div>
<div class="section" id="upload-documents">
<h2>9.2.12. ドキュメントをアップロード<a class="headerlink" href="#upload-documents" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ol class="arabic simple">
<li><p>mroonga.github.comリポジトリをcloneする</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">update-document</span></code> を実行する</p></li>
<li><p>Mroonga.github.comの変更点をcommit&amp;&amp;pushする</p></li>
</ol>
</div>
<div class="section" id="announce-release-for-mailing-list">
<h2>9.2.13. リリースをメーリングリストで告知<a class="headerlink" href="#announce-release-for-mailing-list" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>リリースアナウンスをそれぞれのメーリングリストに送ります</p>
<ul class="simple">
<li><p><a class="reference external" href="mailto:ml&#37;&#52;&#48;mysql&#46;gr&#46;jp">ml<span>&#64;</span>mysql<span>&#46;</span>gr<span>&#46;</span>jp</a> for Japanese</p></li>
<li><p><a class="reference external" href="mailto:groonga-dev&#37;&#52;&#48;lists&#46;osdn&#46;me">groonga-dev<span>&#64;</span>lists<span>&#46;</span>osdn<span>&#46;</span>me</a> for Japanese</p></li>
<li><p><a class="reference external" href="mailto:groonga-talk&#37;&#52;&#48;lists&#46;sourceforge&#46;net">groonga-talk<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a> for English</p></li>
</ul>
</div>
<div class="section" id="announce-release-for-twitter">
<h2>9.2.14. リリースをTwitterで告知<a class="headerlink" href="#announce-release-for-twitter" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Tweetリンクをクリックすると、最新のリリースについてツイートできます。タイトルやブログエントリのURLがツイートに含まれます。</p>
<p>ツイートは日本語と英語のブログエントリから行います。ツイートは <code class="docutils literal notranslate"><span class="pre">groonga</span></code> アカウントでログインした状態で行ってください。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">9.2. Release procedure</a><ul>
<li><a class="reference internal" href="#requirements">9.2.1. 必要なもの</a></li>
<li><a class="reference internal" href="#setup-build-environment">9.2.2. ビルド環境をセットアップする</a></li>
<li><a class="reference internal" href="#bump-version">9.2.3. バージョンをあげる</a></li>
<li><a class="reference internal" href="#describe-the-changes">9.2.4. 変更点を記述する</a></li>
<li><a class="reference internal" href="#generate-configure-script">9.2.5. configureスクリプトの生成</a></li>
<li><a class="reference internal" href="#execute-configure-script">9.2.6. configureスクリプトの実行</a></li>
<li><a class="reference internal" href="#check-whether-you-can-upload-packages">9.2.7. パッケージをアップロード可能か確認する</a></li>
<li><a class="reference internal" href="#execute-make-update-latest-release">9.2.8. make update-latest-releaseを実行する</a></li>
<li><a class="reference internal" href="#tagging-for-release">9.2.9. リリースのためのタグ打ち</a></li>
<li><a class="reference internal" href="#upload-archive-files">9.2.10. アーカイブファイルのアップロード</a></li>
<li><a class="reference internal" href="#create-packages-for-the-release">9.2.11. リリース向けにパッケージを作成する</a><ul>
<li><a class="reference internal" href="#debian">9.2.11.1. Debian</a></li>
<li><a class="reference internal" href="#debian-derivatives-ubuntu">9.2.11.2. Debian系(Ubuntu)</a></li>
<li><a class="reference internal" href="#red-hat-derivatives">9.2.11.3. Red Hat系</a></li>
<li><a class="reference internal" href="#windows">9.2.11.4. Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upload-documents">9.2.12. ドキュメントをアップロード</a></li>
<li><a class="reference internal" href="#announce-release-for-mailing-list">9.2.13. リリースをメーリングリストで告知</a></li>
<li><a class="reference internal" href="#announce-release-for-twitter">9.2.14. リリースをTwitterで告知</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="debug.html"
                        title="前の章へ">9.1. デバッグ方法</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="coding_style.html"
                        title="次の章へ">9.3. コーディングスタイル</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="coding_style.html" title="9.3. コーディングスタイル"
             >次へ</a> |</li>
        <li class="right" >
          <a href="debug.html" title="9.1. デバッグ方法"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mroonga v9.10 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../developer.html" >9. 開発者向け情報</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2019, Mroonga Project.
    </div>
      <script src="http://connect.facebook.net/ja_JP/all.js"></script>

    <script>
      FB.init({
         appId  : null,
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
         xfbml  : true  // parse XFBML
      });
    </script>
  </body>

</html>