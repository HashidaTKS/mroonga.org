---
layout: post.ja
title: Mroonga 3.12リリース
description: Mroonga 3.12をリリースしました！
---

h2. Mroonga 3.12リリース

"Mroonga 3.12":/ja/docs/news.html#release-3-12 をリリースしました！

h3. インストール/アップグレード方法

それぞれの環境毎のインストール方法: "インストール":/ja/docs/install.html

以前のバージョンからアップグレードする場合には、アップグレード手順に注意が必要です。現在お使いのバージョンごとの "アップグレード手順":http://mroonga.org/ja/docs/install.html#upgrade-guide を参照してください。

今回のリリースの主なトピックは以下の通りです。

* ロックタイムアウトを動的に変更できるようになりました
* WプラグマのTritonnとの互換性を改善しました

Wプラグマの挙動については、これまでと非互換な変更となっているので注意してください。該当する場合にはクエリの修正が必要となります。

h3. ロックタイムアウトを動的に変更できるようになりました

今回のリリースでは、ロックタイムアウトを動的に変更できるようになりました。

クラッシュせずにロックが競合してしまった場合、Mroongaからは処理中の扱いにしか見えず、Groonga内部でひたすらロックのタイムアウト待ちになる場合がありえます。

ただ、Groonga内部のタイムアウト設定はソースコード上決めうちになっていたので、これまでは直接Groongaのソースコードを書き換えてビルドする必要がありました。リリースされるたびにパッチをあてて対処しなくてもすむようになっています。

挙動を変更するには、mroonga_lock_timeoutを次のように実行します。1000ミリ秒でタイムアウトする場合はこんな感じです。

<pre>
SET GLOBAL mroonga_lock_timeout = 1000;
</pre>

この機能はyokuさんからの提案で実現しました。経緯については、yokuさんが詳しくエントリを書いてくれています。

* "日々の覚書 Mroongaのロックが突き刺さるとどうなるか":http://yoku0825.blogspot.jp/2013/12/mroonga.html

h3. WプラグマのTritonnとの互換性を改善しました

今回のリリースでは、WプラグマのTritonnとの互換性を改善しました。

Tritonn由来でWプラグマというマルチカラムインデックスでカラムごとに重みづけをする機能があるのですが、このときのセクションの指定が0オリジンだったのを1オリジンに変更しました。これはTritonnと異なる実装だったのを修正したものです。

また、これにあわせてセクションを省略したときの重みが0だったのを1に変更しました。これもTritonnと同じになるように修正したものです。

Wプラグマを使っている既存のクエリーで上記変更の影響を受けるものがあれば修正する必要があります。

h3. さいごに

3.12からの詳細な変更点は "3.12リリース 2013/12/29":/ja/docs/news.html#release-3-12 を確認してください。

それでは、Mroongaでガンガン検索してください！
